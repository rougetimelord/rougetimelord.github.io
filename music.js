var Music=function(){var b=this;this.context=new AudioContext;if("running"!=this.context.state)return!1;this.javascriptNode=this.context.createScriptProcessor(2048,1,1);this.javascriptNode.connect(this.context.destination);this.javascriptNode.onaudioprocess=function(){var a=new Uint8Array(b.analyser.frequencyBinCount);b.analyser.getByteFrequencyData(a);var c=b.getAverageVolume(a);a=document.getElementsByClassName("react");for(var d=0;d<a.length;d++)a[d].classList.remove("light");if(70<=c)for(c=0;c<a.length;c++)a[c].classList.add("light")};this.analyser=this.context.createAnalyser();this.analyser.smoothingTimeConstant=.3;this.analyser.fftSize=1024;this.analyser.connect(this.javascriptNode);this.gainNode=this.context.createGain();this.gainNode.gain.setValueAtTime(0,this.context.currentTime);this.gainNode.connect(this.context.destination);this.firstReq=!0;this.buffers=[];this.song_ind=0;this.songs=["never-met","still-high","dark","fuck-boy"];this.loadCurr=0;document.addEventListener("visibilitychange",function(){b.gainNode.gain.linearRampToValueAtTime(document.hidden?.03:.35,b.context.currentTime+(document.hidden?.75:.3));document.hidden&&b.gainNode.gain.setValueAtTime(0,b.context.currentTime+60)});this.changeSong()};Music.prototype.playSound=function(b){this.source=this.context.createBufferSource();this.source.connect(this.analyser);this.source.connect(this.gainNode);this.source.buffer=b;this.duration=1E3*b.duration;this.source.start(0);this.songTimeout=setTimeout(this.changeSong.bind(this),this.duration);this.firstReq&&(this.gainNode.gain.linearRampToValueAtTime(.35,this.context.currentTime+1.5),this.firstReq=!1)};Music.prototype.makeReq=function(b){var a=this;a.request=new XMLHttpRequest;a.request.open("GET",b,!0);a.request.responseType="arraybuffer";a.request.onload=function(){a.context.decodeAudioData(a.request.response,function(b){a.firstReq&&a.playSound(b);a.buffers.push(b);a.buffers.length<a.songs.length&&a.loadNext()})};a.request.send()};Music.prototype.load=function(b){var a="./Content/"+this.songs[b]+".mp3";this.loadCurr=b;this.makeReq(a)};Music.prototype.loadNext=function(){this.loadCurr++;this.loadCurr<this.songs.length||(this.loadCurr=0);this.load(this.loadCurr)};Music.prototype.getAverageVolume=function(b){for(var a=0,c=b.length,d=0;d<c;d++)a+=b[d];return a/c};Music.prototype.changeSong=function(){this.song_ind=Math.floor(Math.random()*this.buffers.length);this.firstReq?(this.song_ind=Math.floor(Math.random()*this.songs.length),this.load(this.song_ind)):this.playSound(this.buffers[this.song_ind])};