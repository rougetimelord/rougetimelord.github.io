var Music=function(){var a=this;this.songTimeout=this.request=this.duration=this.source="";window.context=new AudioContext;if("running"!=window.context.state)return!1;this.javascriptNode=window.context.createScriptProcessor(2048,1,1);this.javascriptNode.connect(window.context.destination);this.javascriptNode.onaudioprocess=function(){var b=new Uint8Array(a.analyser.frequencyBinCount);a.analyser.getByteFrequencyData(b);var c=a.getAverageVolume(b);b=document.getElementsByClassName("react");for(var d=0;d<b.length;d++)b[d].classList.remove("light");if(70<=c)for(c=0;c<b.length;c++)b[c].classList.add("light")};this.analyser=window.context.createAnalyser();this.analyser.smoothingTimeConstant=.3;this.analyser.fftSize=1024;this.analyser.connect(this.javascriptNode);this.gainNode=window.context.createGain();this.gainNode.gain.setValueAtTime(0,window.context.currentTime);this.gainNode.connect(window.context.destination);this.firstReq=!0;this.buffers=[];this.song_ind=0;this.songs=["never-met","still-high","dark","fuck-boy"];this.loadCurr=0;document.addEventListener("visibilitychange",function(){a.gainNode.gain.linearRampToValueAtTime(document.hidden?.03:.35,window.context.currentTime+(document.hidden?.75:.3));document.hidden&&a.gainNode.gain.setValueAtTime(.01,window.context.currentTime+60)});this.changeSong()};Music.prototype.playSound=function(a){this.source=window.context.createBufferSource();this.source.connect(this.analyser);this.source.connect(this.gainNode);this.source.buffer=a;this.duration=1E3*a.duration;this.source.start(0);this.songTimeout=setTimeout(this.changeSong.bind(this),this.duration);this.firstReq&&(this.gainNode.gain.linearRampToValueAtTime(.35,window.context.currentTime+1.5),this.firstReq=!1)};Music.prototype.makeReq=function(a){var b=this;this.request=new XMLHttpRequest;this.request.addEventListener("load",function(){window.context.decodeAudioData(this.response,function(a){b.firstReq&&b.playSound(a);b.buffers.push(a);b.buffers.length<b.songs.length&&b.loadNext()})});this.request.responseType="arraybuffer";this.request.open("GET",a,!0);this.request.send()};Music.prototype.load=function(a){var b="./Content/"+this.songs[a]+".ogg";this.loadCurr=a;this.makeReq(b)};Music.prototype.loadNext=function(){this.loadCurr++;this.loadCurr<this.songs.length?this.load(this.loadCurr):(this.loadCurr=0,this.load(0))};Music.prototype.getAverageVolume=function(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d];return b/c};Music.prototype.changeSong=function(){this.song_ind=Math.floor(Math.random()*this.buffers.length);this.firstReq?(this.song_ind=Math.floor(Math.random()*this.songs.length),this.load(this.song_ind)):this.playSound(this.buffers[this.song_ind])};